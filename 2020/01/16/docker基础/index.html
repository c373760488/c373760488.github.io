<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Muse","version":"7.7.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="基础知识docker 虚拟机的区别docker没有虚拟化os（操作系统内核），使用的宿主机的内核，节省资源对于挑内核的服务，docker无能为力，比如c++的编译，还有docker不适合兼容性测试">
<meta name="keywords" content="学院">
<meta property="og:type" content="article">
<meta property="og:title" content="docker基础">
<meta property="og:url" content="http:&#x2F;&#x2F;yoursite.com&#x2F;2020&#x2F;01&#x2F;16&#x2F;docker%E5%9F%BA%E7%A1%80&#x2F;index.html">
<meta property="og:site_name" content="Coye&#39;s blog">
<meta property="og:description" content="基础知识docker 虚拟机的区别docker没有虚拟化os（操作系统内核），使用的宿主机的内核，节省资源对于挑内核的服务，docker无能为力，比如c++的编译，还有docker不适合兼容性测试">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2020-02-25T12:43:02.000Z">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://yoursite.com/2020/01/16/docker%E5%9F%BA%E7%A1%80/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true
  };
</script>

  <title>docker基础 | Coye's blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Coye's blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">给自己看的=。=</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
  </ul>

</nav>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/01/16/docker%E5%9F%BA%E7%A1%80/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Coye">
      <meta itemprop="description" content="记录测试的点点滴滴。。。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Coye's blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          docker基础
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-01-16 11:15:27" itemprop="dateCreated datePublished" datetime="2020-01-16T11:15:27+08:00">2020-01-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-02-25 20:43:02" itemprop="dateModified" datetime="2020-02-25T20:43:02+08:00">2020-02-25</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h2><h3 id="docker-虚拟机的区别"><a href="#docker-虚拟机的区别" class="headerlink" title="docker 虚拟机的区别"></a>docker 虚拟机的区别</h3><p>docker没有虚拟化os（操作系统内核），使用的宿主机的内核，节省资源<br>对于挑内核的服务，docker无能为力，比如c++的编译，还有docker不适合兼容性测试<br> <a id="more"></a></p>
<h3 id="容器的网络连接"><a href="#容器的网络连接" class="headerlink" title="容器的网络连接"></a>容器的网络连接</h3><ul>
<li>容器或虚拟机之间靠网络名称空间隔离。2个容器间通信需要虚拟网卡设备对，即每个容器一个个虚拟网卡，必须成对出现。所以3个容器相互通信则需要3对虚拟网卡设备对。如果容器多了需要的虚拟网卡就很多。<ul>
<li>bridge容器间通信<br>所以docker使用的是linux的桥接功能，容器与网桥间建立虚拟网卡设备对，容器A给某一ip发消息，首先由A的虚拟网卡发送到网桥上的A1虚拟网卡，然后A1在网桥上进行广播，所有网桥上的虚拟网卡都会受到消息，其他虚拟网卡发现消息中的ip地址不是自己的就会抛弃该消息。如果是自己的ip就接受处理。如果网桥上的虚拟网卡太多，广播就会产生广播风暴。<ul>
<li>-p<br>ipv4_forward需要为true。打开后所有发送给宿主机的请求，如果ip不为宿主机，则转发给docker的网桥上（相当于路由器）。Docker run –p, 通过iptables创建一条规则，凡是发送到本 机的8080端口的数据报文， 全部篡改目的ip地址 修改成目标容器的ip地址+端口号。然后在网桥上进行广播寻址</li>
</ul>
</li>
<li>host<br>容器直接联通宿主机的网络</li>
<li>container<br>容器B连接在容器A上，容器A连向docker网桥，AB之间用localhost 访问就好</li>
</ul>
</li>
</ul>
<h2 id="安装docker"><a href="#安装docker" class="headerlink" title="安装docker"></a>安装docker</h2><ul>
<li><p>Docker 要求 CentOS 系统的内核版本高于 3.10 ，查看本页面的前提条件来验证你的CentOS 版本是否支持 Docker 。<br>通过 uname -r 命令查看你当前的内核版本</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname -r</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用 root 权限登录 Centos。确保 yum 包更新到最新。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum update</span><br></pre></td></tr></table></figure></li>
<li><p>卸载旧版本(如果安装过旧版本的话)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum remove docker  docker-common docker-selinux docker-engine</span><br></pre></td></tr></table></figure></li>
<li><p>安装需要的软件包， yum-util 提供yum-config-manager功能，另外两个是devicemapper驱动依赖的</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install -y yum-utils device-mapper-persistent-data lvm2</span><br></pre></td></tr></table></figure>
</li>
<li><p>设置yum源</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo</span><br><span class="line">或者</span><br><span class="line">sudo yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br></pre></td></tr></table></figure>
</li>
<li><p>可以查看所有仓库中所有docker版本，并选择特定版本安装</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum list docker-ce --showduplicates | sort -r</span><br></pre></td></tr></table></figure></li>
<li><p>安装docker</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install docker-ce  <span class="comment">#由于repo中默认只开启stable仓库，故这里安装的是最新稳定版17.12.0</span></span><br><span class="line">sudo yum install &lt;FQPN&gt;  <span class="comment"># 例如：sudo yum install docker-ce-17.12.0.ce</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>启动并加入开机启动</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl start docker</span><br><span class="line">sudo systemctl <span class="built_in">enable</span> docker</span><br></pre></td></tr></table></figure></li>
<li><p>验证安装是否成功(有client和service两部分表示docker安装启动都成功了)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker version</span><br></pre></td></tr></table></figure>

<h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><p>1、因为之前已经安装过旧版本的docker，在安装的时候报错如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Transaction check error:</span><br><span class="line">  file /usr/bin/docker from install of docker-ce-17.12.0.ce-1.el7.centos.x86_64 conflicts with file from package docker-common-2:1.12.6-68.gitec8512b.el7.centos.x86_64</span><br><span class="line">  file /usr/bin/docker-containerd from install of docker-ce-17.12.0.ce-1.el7.centos.x86_64 conflicts with file from package docker-common-2:1.12.6-68.gitec8512b.el7.centos.x86_64</span><br><span class="line">  file /usr/bin/docker-containerd-shim from install of docker-ce-17.12.0.ce-1.el7.centos.x86_64 conflicts with file from package docker-common-2:1.12.6-68.gitec8512b.el7.centos.x86_64</span><br><span class="line">  file /usr/bin/dockerd from install of docker-ce-17.12.0.ce-1.el7.centos.x86_64 conflicts with file from package docker-common-2:1.12.6-68.gitec8512b.el7.centos.x86_64</span><br></pre></td></tr></table></figure></li>
<li><p>卸载旧版本的包</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum erase docker-common-2:1.12.6-68.gitec8512b.el7.centos.x86_64</span><br></pre></td></tr></table></figure></li>
<li><p>再次安装docker</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install docker-ce</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="基础命令"><a href="#基础命令" class="headerlink" title="基础命令"></a>基础命令</h2><p>请先搞懂镜像，容器</p>
<ul>
<li><p>拉取镜像</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#拉取jenkins镜像，默认应该是最新</span></span><br><span class="line">docker pull jenkins </span><br><span class="line"><span class="comment">#拉取特定版本</span></span><br><span class="line">docker pull jenkins:2.60.2</span><br></pre></td></tr></table></figure>
</li>
<li><p>打标签，推送</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker tag jenkins  myjenkins</span><br><span class="line">docker push myjenkins</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看镜像和容器</p>
<ul>
<li>镜像字段名含义<br>  respository 镜像名称<br>  TAG  版本名<br>  IMAGE ID  全球唯一标识<br>  CREATED  镜像被制作的时间<br>  SIZE  镜像大小</li>
<li>容器字段名含义<br>  CONTAINER ID  容器id<br>  IMAGE       容器依赖的镜像<br>  COMMAND     运行参数<br>  CREATED     创建时间<br>  STATUS      状态<br>  PORTS       端口<br>  NAMES       容器名称</li>
</ul>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看已有镜像</span></span><br><span class="line">docker images</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#查看所有正在运行容器,加 -s 可以查看运行容器所占用的空间</span></span><br><span class="line">docker ps </span><br><span class="line"><span class="comment">#停止容器运行 containerId 是容器的ID</span></span><br><span class="line">docker stop containerId </span><br><span class="line"><span class="comment">#查看所有容器</span></span><br><span class="line">docker ps -a </span><br><span class="line"><span class="comment">#查看所有容器ID</span></span><br><span class="line">docker ps -a -q </span><br><span class="line"><span class="comment">#搜索xxx镜像</span></span><br><span class="line">docker search xxx  </span><br><span class="line"><span class="comment">#查看所有容器ip</span></span><br><span class="line">docker inspect --format=<span class="string">'&#123;&#123;.Name&#125;&#125; - &#123;&#123;range.NetworkSettings.Networks&#125;&#125;&#123;&#123;.IPAddress&#125;&#125;&#123;&#123;end&#125;&#125;'</span> $(docker ps -aq)</span><br></pre></td></tr></table></figure>

<ul>
<li><p>删除镜像和容器</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#删除指定多个镜像</span></span><br><span class="line">docker rmi image1 image2    </span><br><span class="line"> <span class="comment">#删除所有未打 dangling 标签的镜像</span></span><br><span class="line">docker rmi $(docker images -q -f dangling=<span class="literal">true</span>)</span><br><span class="line"><span class="comment">#通过镜像的id来删除指定镜像</span></span><br><span class="line">docker rmi &lt;image id&gt;</span><br><span class="line"><span class="comment">#删除所有镜像</span></span><br><span class="line">docker rmi $(docker images -q)</span><br><span class="line"><span class="comment">#未安装完的镜像清理（tag=none）</span></span><br><span class="line">docker stop $(docker ps -a | grep <span class="string">"Exited"</span> | awk <span class="string">'&#123;print $1 &#125;'</span>)</span><br><span class="line">docker rm $(docker ps -a | grep <span class="string">"Exited"</span> | awk <span class="string">'&#123;print $1 &#125;'</span>)</span><br><span class="line">docker rmi $(docker images | grep <span class="string">"none"</span> | awk <span class="string">'&#123;print $3&#125;'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#强制删除容器，运行的也可以</span></span><br><span class="line">docker rm -f myjenkins</span><br><span class="line"><span class="comment">#杀死所有正在运行的容器</span></span><br><span class="line">docker <span class="built_in">kill</span> $(docker ps -a -q)</span><br><span class="line"><span class="comment">#删除所有已经停止的容器</span></span><br><span class="line">docker rm $(docker ps -a -q)</span><br></pre></td></tr></table></figure>
</li>
<li><p>为这些命令创建别名</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ~/.bash_aliases</span></span><br><span class="line"><span class="comment"># 杀死所有正在运行的容器.</span></span><br><span class="line"><span class="built_in">alias</span> dockerkill=<span class="string">'docker kill $(docker ps -a -q)'</span></span><br><span class="line"><span class="comment"># 删除所有已经停止的容器.</span></span><br><span class="line"><span class="built_in">alias</span> dockercleanc=<span class="string">'docker rm $(docker ps -a -q)'</span></span><br><span class="line"><span class="comment"># 删除所有未打标签的镜像.</span></span><br><span class="line"><span class="built_in">alias</span> dockercleani=<span class="string">'docker rmi $(docker images -q -f dangling=true)'</span></span><br><span class="line"><span class="comment"># 删除所有已经停止的容器和未打标签的镜像.</span></span><br><span class="line"><span class="built_in">alias</span> dockerclean=<span class="string">'dockercleanc || true &amp;&amp; dockercleani'</span></span><br></pre></td></tr></table></figure></li>
<li><p>保存镜像为tar包,将tar包加载为镜像</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#保存为tar包</span></span><br><span class="line">docker save jenkins &gt; myjenkins.tar</span><br><span class="line"><span class="comment">#将tar包加载为镜像</span></span><br><span class="line">docker load &lt; myjenkins.tar</span><br></pre></td></tr></table></figure>
</li>
<li><p>运行docker相关</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#运行镜像,关闭窗口，镜像随之关闭</span></span><br><span class="line">docker run jenkins </span><br><span class="line"><span class="comment">#-d是后台运行，将Jenkins镜像放在容器myjenkins中运行 </span></span><br><span class="line">docker run -d --name myjenkins jenkins</span><br><span class="line"><span class="comment">#端口映射,本机的8000映射到容器的8080端口</span></span><br><span class="line">docker run -d --name myjenkins -p 8000:8080 jenkins </span><br><span class="line"><span class="comment">#查看容器日志</span></span><br><span class="line">docker logs myjenkins</span><br><span class="line"><span class="comment">#持续查看日志</span></span><br><span class="line">docker logs -f myjenkins</span><br><span class="line"><span class="comment">#查看容器配置</span></span><br><span class="line">docker inspect myjenkins</span><br><span class="line"><span class="comment">#进入容器 -it启动一个新的虚拟交互窗口</span></span><br><span class="line">docker <span class="built_in">exec</span> -it myjenkins bash <span class="comment">#exit 退出</span></span><br><span class="line"><span class="comment">#执行容器命令</span></span><br><span class="line">docker <span class="built_in">exec</span> myjenkins <span class="built_in">echo</span> <span class="string">"aaaa"</span></span><br><span class="line">docker <span class="built_in">exec</span> -d myjenkin <span class="built_in">echo</span> <span class="string">"aaa"</span> <span class="comment">#-d后台运行</span></span><br><span class="line"><span class="comment">#将宿主机文件copy到容器中</span></span><br><span class="line">docker cp ~/a.conf myjenkins:~/ </span><br><span class="line"><span class="comment">#将容器文件copy到宿主机</span></span><br><span class="line">docker ps myjenkins:~/a.conf ~/</span><br><span class="line"><span class="comment">#启动容器时，网络模式</span></span><br><span class="line">docker run -d --name myjenkins --network host jenkins</span><br><span class="line"><span class="comment">#挂在</span></span><br><span class="line">-v /home/docker/jenkins:/etc</span><br><span class="line">ps:注意权限   ssudo chown -R 1000:1000 /home/docker/jenkins</span><br><span class="line"><span class="comment"># --link 容器联通，同一台物理机上用--link  不同物理机用env注入</span></span><br><span class="line">docker run -d --name mariadb -e ALLOW_EMPTY_PASSWORD=yes -e MARIADB_USER=bn_testlink -e MARIADB_DATABASE=bitnami_testlink -v /home/gaofei/<span class="built_in">test</span>/mysql:/var/lib/mysql -p 8088:3306 bitnami/mariadb:latest </span><br><span class="line">docker run -d --name testlink -p 8099:80 -p 444:443 -e ALLOW_EMPTY_PASSWORD=yes -e TESTLINK_DATABASE_USER=bn_testlink -e TESTLINK_DATABASE_NAME=bitnami_testlink --link mariadb bitnami/testlink:latest</span><br></pre></td></tr></table></figure>
<h2 id="创建私有镜像仓库"><a href="#创建私有镜像仓库" class="headerlink" title="创建私有镜像仓库"></a>创建私有镜像仓库</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">docker pull registry:2 <span class="comment">#从docker-hub拉取私有仓库镜像</span></span><br><span class="line">docker run -d -p 5000:5000 -v ~/workspace/dockerProject/registry:/var/lib/registry --restart=always --name registry registry:2 <span class="comment">#启动</span></span><br><span class="line">docker pull busybox  <span class="comment">#从docker-hub拉取busybox</span></span><br><span class="line">docker tag busybox localhost:5000/bosybox:v1.0 <span class="comment">#给镜像打标签 打了标签以后才能上传到私有镜像仓库 docker tag 原镜像名称:tag 新镜像名称:tag</span></span><br><span class="line">docker push localhost:5000/bosybox:v1.0 <span class="comment">#推送到私有镜像仓库</span></span><br><span class="line">curl http://localhost:5000/v2/_catalog  <span class="comment">#镜像仓库已有的镜像</span></span><br><span class="line">docker pull localhost:5000/bosybox:v1.0 <span class="comment">#非本机拉取需要修改镜像源（绕过https认证）</span></span><br><span class="line">docker commit &lt;容器名&gt; &lt;新镜像名&gt;  <span class="comment">#把已启动的容器制作为镜像，这种方式不推荐，因为不知道对镜像做了什么修改，推荐使用dockerfile</span></span><br></pre></td></tr></table></figure>
<h2 id="Dockerfile"><a href="#Dockerfile" class="headerlink" title="Dockerfile"></a>Dockerfile</h2></li>
<li><p>From指令：指定继承哪个镜像 </p>
</li>
<li><p>ADD : 将工作目录下的某个目录或者文件copy到镜像的某个路径下 </p>
</li>
<li><p>Run：执行shell 命令 </p>
</li>
<li><p>ENTRYPOINT: 指定容器启动脚本 </p>
</li>
<li><p>ENV：指定容器启动时的环境变量(注意，只有在容器启动时，启动脚本能读取到，如果希望其 他用户登录到容器也生效的话，需要写入.bashrc) </p>
</li>
<li><p>USER：容器启动时使用的用户 </p>
</li>
<li><p>WORKDIR: 容器启动时的工作目录</p>
</li>
<li><p>docker build -t 镜像名称:tag &lt;工作目录&gt;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">FROM centos:7</span><br><span class="line">USER root</span><br><span class="line">ADD run.sh /root/</span><br><span class="line">ENV DOCKER_HOME=/usr/<span class="built_in">local</span>/docker <span class="comment">#这个环境变量是给dockerfile用的</span></span><br><span class="line">RUN <span class="built_in">echo</span> <span class="string">"hello world"</span> &gt;&gt; /root/hello.log \</span><br><span class="line">    &amp;&amp; <span class="built_in">echo</span> <span class="string">"export DOCKER_HOME=/usr/local/docker"</span> &gt;&gt; /root/.bashrc  <span class="comment">#z这个是系统环境变量</span></span><br><span class="line">ENTRYPOINT [<span class="string">"/root/run.sh"</span>]</span><br></pre></td></tr></table></figure>












</li>
</ul>
<h2 id="prometheus监控"><a href="#prometheus监控" class="headerlink" title="prometheus监控"></a>prometheus监控</h2><p><a href="https://app.yinxiang.com/fx/a686e103-c7de-4255-9cef-b82d487a71a3" target="_blank" rel="noopener">https://app.yinxiang.com/fx/a686e103-c7de-4255-9cef-b82d487a71a3</a><br><a href="https://testerhome.com/topics/21472" target="_blank" rel="noopener">https://testerhome.com/topics/21472</a></p>
<ul>
<li><p>prometheus官网下载安装node_exporter 启动</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nohup ./node_exporter &gt;&gt; node_exporter.log 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure>
</li>
<li><p>安装mysql</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -p 3306:3306 --name mysql -v ~/docker/mysql/conf:/etc/mysql -v ~/docker/mysql/logs:/var/<span class="built_in">log</span>/mysql -v ~/docker/mysql/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=feifei911 -d mysql:latest</span><br></pre></td></tr></table></figure>
</li>
<li><p>docker安装prom/mysqld-exporter 需要先启动mysql</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name mysql-exporter -p 9104:9104 -e DATA_SOURCE_NAME=<span class="string">"root:feifei911@(193.112.47.128:3306)/mysql"</span> prom/mysqld-exporter</span><br></pre></td></tr></table></figure>
</li>
<li><p>docker 安装prom/prometheus 启动</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 9090:9090 -v `<span class="built_in">pwd</span>`/prometheus.yml:/etc/prometheus/prometheus.yml --name=myprometheus prom/prometheus --config.file=/etc/prometheus/prometheus.yml</span><br></pre></td></tr></table></figure>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">global:</span></span><br><span class="line"><span class="attr">  scrape_interval:</span>     <span class="number">15</span><span class="string">s</span></span><br><span class="line"><span class="attr">  evaluation_interval:</span> <span class="number">15</span><span class="string">s</span></span><br><span class="line"></span><br><span class="line"><span class="attr">scrape_configs:</span></span><br><span class="line"><span class="attr">  - job_name:</span> <span class="string">'prometheus'</span></span><br><span class="line"><span class="attr">    static_configs:</span></span><br><span class="line"><span class="attr">    - targets:</span> <span class="string">['localhost:9090']</span></span><br><span class="line"><span class="attr">  - job_name:</span> <span class="string">'node_exporter'</span></span><br><span class="line"><span class="attr">    static_configs:</span></span><br><span class="line"><span class="attr">    - targets:</span> <span class="string">['193.112.47.128:9100']</span></span><br><span class="line"><span class="attr">  - job_name:</span> <span class="string">'mysql'</span></span><br><span class="line"><span class="attr">    static_configs:</span></span><br><span class="line"><span class="attr">    - targets:</span> <span class="string">['193.112.47.128:9104']</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>docker启动一个grafana</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 3000:3000 --name=jmeterGraf grafana/grafana</span><br></pre></td></tr></table></figure>
<p>create a data source 填写prometheus的地址<a href="http://localhost:9090/" target="_blank" rel="noopener">http://localhost:9090/</a>  save and test<br>import模板<br>模板地址：<a href="https://grafana.com/grafana/dashboards/8919" target="_blank" rel="noopener">https://grafana.com/grafana/dashboards/8919</a></p>
</li>
</ul>
<h2 id="docker-selenium"><a href="#docker-selenium" class="headerlink" title="docker selenium"></a>docker selenium</h2><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker pull selenium/node-chrome-debug:3.7.1-beryllium</span><br><span class="line">docker pull selenium/hub:3.7.1-beryllium</span><br><span class="line"></span><br><span class="line">docker run --name=hub -p 5001:4444 -e GRID_TIMEOUT=0 -e GRID_THROW_ON_CAPABILITY_NOT_PRESENT=<span class="literal">true</span> -e GRID_NEW_SESSION_WAIT_TIMEOUT=-1 -e GRID_BROWSER_TIMEOUT=15000 -e GRID_TIMEOUT=30000 -e GRID_CLEAN_UP_CYCLE=30000 -d selenium/hub:3.7.1-beryllium</span><br><span class="line">docker run --name=chrome -p 5900:5900 -e NODE_MAX_INSTANCES=1 -e NODE_MAX_SESSION=6 -e NODE_REGISTER_CYCLE=5000 -e DBUS_SESSION_BUS_ADDRESS=/dev/null -v ~/workspace/dockerProject/selenium/dev/shm:/dev/shm --link hub -d selenium/node-chrome-debug:3.7.1-beryllium</span><br><span class="line">如果不使用--link 需要注入env HUB_PORT_4444_ADDR，HUB_PORT_4444_PORT</span><br></pre></td></tr></table></figure>
<p>下载vnc view 连接 5902端口<br>VNC密码是：secret<br><a href="https://github.com/ycwdaaaa/techUI" target="_blank" rel="noopener">https://github.com/ycwdaaaa/techUI</a> 执行该代码，网址断言需要改一下,或者：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver <span class="keyword">import</span> DesiredCapabilities</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestDemo</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setup</span><span class="params">(self)</span>:</span></span><br><span class="line">        url = <span class="string">"http://127.0.0.1:5001/wd/hub"</span></span><br><span class="line">        url1 = <span class="string">"http://193.112.47.128:5001/wd/hub"</span></span><br><span class="line">        chrome_options = webdriver.ChromeOptions()</span><br><span class="line">        <span class="comment"># 解决DevToolsActivePort文件不存在的报错</span></span><br><span class="line">        <span class="comment"># chrome_options.add_argument('--no-sandbox')</span></span><br><span class="line">        <span class="comment"># 指定浏览器分辨率</span></span><br><span class="line">        <span class="comment"># chrome_options.add_argument('window-size=1920x3000')</span></span><br><span class="line">        <span class="comment"># 谷歌文档提到需要加上这个属性来规避bug</span></span><br><span class="line">        <span class="comment"># chrome_options.add_argument('--disable-gpu')</span></span><br><span class="line">        <span class="comment"># 隐藏滚动条, 应对一些特殊页面</span></span><br><span class="line">        <span class="comment"># chrome_options.add_argument('--hide-scrollbars')</span></span><br><span class="line">        <span class="comment"># 不加载图片, 提升速度</span></span><br><span class="line">        <span class="comment"># chrome_options.add_argument('blink-settings=imagesEnabled=false')</span></span><br><span class="line">        <span class="comment"># 浏览器不提供可视化页面. linux下如果系统不支持可视化不加这条会启动失败</span></span><br><span class="line">        chrome_options.add_argument(<span class="string">'--headless'</span>)</span><br><span class="line">        self.driver = webdriver.Remote(command_executor=url1,</span><br><span class="line">                                  desired_capabilities=DesiredCapabilities.CHROME,</span><br><span class="line">                                  options=chrome_options)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_0</span><span class="params">(self)</span>:</span></span><br><span class="line"></span><br><span class="line">        self.driver.get(<span class="string">"http://www.baidu.com"</span>)</span><br><span class="line">        time.sleep(<span class="number">1</span>)</span><br><span class="line">        a=self.driver.page_source</span><br><span class="line">        print(<span class="string">"\n"</span>,<span class="string">"-"</span>*<span class="number">20</span>)</span><br><span class="line">        print(a)</span><br><span class="line">        print(<span class="string">"-"</span>*<span class="number">30</span>)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">teardown</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.driver.quit()</span><br></pre></td></tr></table></figure>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E5%AD%A6%E9%99%A2/" rel="tag"># 学院</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/01/15/java%E6%B5%8B%E8%AF%95%E5%9F%BA%E7%A1%80/" rel="prev" title="java测试基础">
      <i class="fa fa-chevron-left"></i> java测试基础
    </a></div>
      <div class="post-nav-item">
    <a href="/2020/01/17/%E6%95%B0%E6%8D%AE%E5%BA%93%E5%9F%BA%E7%A1%80/" rel="next" title="数据库基础">
      数据库基础 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#基础知识"><span class="nav-number">1.</span> <span class="nav-text">基础知识</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#docker-虚拟机的区别"><span class="nav-number">1.1.</span> <span class="nav-text">docker 虚拟机的区别</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#容器的网络连接"><span class="nav-number">1.2.</span> <span class="nav-text">容器的网络连接</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#安装docker"><span class="nav-number">2.</span> <span class="nav-text">安装docker</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#问题"><span class="nav-number">2.1.</span> <span class="nav-text">问题</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#基础命令"><span class="nav-number">3.</span> <span class="nav-text">基础命令</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#创建私有镜像仓库"><span class="nav-number">4.</span> <span class="nav-text">创建私有镜像仓库</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Dockerfile"><span class="nav-number">5.</span> <span class="nav-text">Dockerfile</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#prometheus监控"><span class="nav-number">6.</span> <span class="nav-text">prometheus监控</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#docker-selenium"><span class="nav-number">7.</span> <span class="nav-text">docker selenium</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#安装"><span class="nav-number">7.1.</span> <span class="nav-text">安装</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Coye"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">Coye</p>
  <div class="site-description" itemprop="description">记录测试的点点滴滴。。。</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">47</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">15</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Coye</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v4.0.0
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">主题 – <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> v7.7.2
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script>
<script src="/js/schemes/muse.js"></script>
<script src="/js/next-boot.js"></script>



  















  

  

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"model":{"jsonPath":"/live2dw/assets/hibiki.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":false},"log":false});</script></body>
</html>
